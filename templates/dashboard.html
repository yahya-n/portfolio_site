{% extends 'base.html' %}

{% block content %}
<!-- Font Awesome & Chart.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    :root {
        --primary: #6366f1;
        --primary-hover: #4f46e5;
        --secondary: #ec4899;

        /* Permanent Dark Theme Variables */
        --bg-body: #0f172a;
        /* Slate 900 */
        --bg-panel: rgba(30, 41, 59, 0.7);
        /* Slate 800 with transparency */
        --text-main: #f8fafc;
        /* Slate 50 */
        --text-muted: #94a3b8;
        /* Slate 400 */
        --border-color: rgba(255, 255, 255, 0.08);

        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        --sidebar-width: 260px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        overflow-x: hidden;
    }

    /* Layout */
    .dashboard-container {
        display: flex;
        min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
        width: var(--sidebar-width);
        background: var(--bg-panel);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-right: 1px solid var(--border-color);
        position: fixed;
        height: 100vh;
        z-index: 1000;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        transition: transform 0.3s ease;
    }

    .brand {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .nav-item {
        margin-bottom: 0.5rem;
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        color: var(--text-muted);
        border-radius: 0.75rem;
        font-weight: 500;
        transition: var(--transition);
    }

    .nav-link i {
        width: 24px;
        margin-right: 12px;
    }

    .nav-link:hover,
    .nav-link.active {
        background: rgba(99, 102, 241, 0.15);
        color: #fff;
        /* Brighter white for active state */
        text-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
    }

    .nav-link.active {
        background: var(--primary);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    /* Main Content */
    .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 2rem;
        width: calc(100% - var(--sidebar-width));
    }

    /* Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-main);
    }

    /* Cards */
    .glass-panel {
        background: var(--bg-panel);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
    }

    .glass-panel:hover {
        box-shadow: var(--shadow-lg);
        border-color: rgba(99, 102, 241, 0.4);
        background: rgba(30, 41, 59, 0.85);
    }

    /* Forms */
    .form-control {
        background: rgba(0, 0, 0, 0.2);
        /* Darker input background */
        border: 1px solid var(--border-color);
        color: var(--text-main);
        padding: 0.6rem 1rem;
        border-radius: 0.5rem;
    }

    .form-control:focus {
        background: rgba(0, 0, 0, 0.3);
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        color: #fff;
    }

    /* Improved Placeholder Colors */
    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.35);
        /* Distinct light gray */
        opacity: 1;
    }

    /* Buttons */
    .btn-primary {
        background: var(--primary);
        border: none;
        padding: 0.6rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-hover);
        box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
    }

    .btn-outline-secondary {
        border-color: var(--border-color);
        color: var(--text-muted);
    }

    .btn-outline-secondary:hover {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-main);
        border-color: rgba(255, 255, 255, 0.2);
    }

    /* Tables */
    .table {
        color: var(--text-muted);
    }

    .table th {
        color: var(--text-main);
        font-weight: 600;
        border-bottom-color: var(--border-color);
    }

    .table td {
        border-bottom-color: var(--border-color);
    }

    /* Mobile */
    .mobile-toggle {
        display: none;
    }

    @media (max-width: 768px) {
        .sidebar {
            transform: translateX(-100%);
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .main-content {
            margin-left: 0;
            width: 100%;
        }

        .mobile-toggle {
            display: block;
        }
    }

    /* Utility */
    .text-sm-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.5);
        /* Lighter label for dark mode */
        margin-bottom: 0.5rem;
        display: block;
    }
</style>

<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <i class="fas fa-layer-group"></i> Admin Panel
            <button class="btn btn-sm btn-outline-secondary d-md-none ms-auto" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <nav class="nav flex-column nav-pills" id="v-pills-tab" role="tablist">
            <button class="nav-link active" id="v-pills-analytics-tab" data-bs-toggle="pill"
                data-bs-target="#v-pills-analytics" type="button"><i class="fas fa-chart-pie"></i> Analytics</button>
            <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile"
                type="button"><i class="fas fa-user-circle"></i> Profile</button>
            <button class="nav-link" id="v-pills-skills-tab" data-bs-toggle="pill" data-bs-target="#v-pills-skills"
                type="button"><i class="fas fa-code"></i> Skills</button>
            <button class="nav-link" id="v-pills-projects-tab" data-bs-toggle="pill" data-bs-target="#v-pills-projects"
                type="button"><i class="fas fa-laptop-code"></i> Projects</button>
            <button class="nav-link" id="v-pills-certs-tab" data-bs-toggle="pill" data-bs-target="#v-pills-certs"
                type="button"><i class="fas fa-award"></i> Certifications</button>
            <button class="nav-link" id="v-pills-contact-tab" data-bs-toggle="pill" data-bs-target="#v-pills-contact"
                type="button"><i class="fas fa-address-book"></i> Contact</button>
        </nav>

        <div class="mt-auto">
            <a href="{{ url_for('logout') }}" onclick="return confirm('Logout?')" class="nav-link text-danger">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-outline-secondary mobile-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Dashboard</h1>
            </div>
            <div class="d-flex align-items-center gap-3">
                <!-- Theme toggle removed (Dark mode is now enforced) -->
                <div class="d-none d-md-block text-end">
                    <small class="text-light d-block" style="line-height: 1;">Welcome back,</small>
                    <span style="font-weight: 600; color: #fff;">{{ data.profile.name }}</span>
                </div>
                <img src="{{ data.profile.image }}" alt="Profile" class="rounded-circle border border-secondary"
                    style="width: 40px; height: 40px; object-fit: cover;">
            </div>
        </header>

        <div class="tab-content" id="v-pills-tabContent">

            <!-- ANALYTICS TAB -->
            <div class="tab-pane fade show active" id="v-pills-analytics">
                <div class="row g-4">
                    <!-- Big Chart -->
                    <div class="col-12">
                        <div class="glass-panel p-4 h-100">
                            <div class="d-flex justify-content-between mb-4">
                                <h5 class="fw-bold text-white">Traffic Overview</h5>
                                <span class="badge bg-primary bg-opacity-25 text-white">Last 30 Days</span>
                            </div>
                            <div style="height: 300px;">
                                <canvas id="dailyVisitsChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Small Charts -->
                    <div class="col-md-4">
                        <div class="glass-panel p-4 h-100">
                            <h5 class="fw-bold mb-3 text-white">Interactions</h5>
                            <div style="height: 200px;">
                                <canvas id="interactionsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="glass-panel p-4 h-100">
                            <h5 class="fw-bold mb-3 text-white">Top Pages</h5>
                            <div style="height: 200px;">
                                <canvas id="pageViewsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="glass-panel p-4 h-100">
                            <h5 class="fw-bold mb-3 text-white">Section Popularity</h5>
                            <div style="height: 200px;">
                                <canvas id="sectionViewsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PROFILE TAB -->
            <div class="tab-pane fade" id="v-pills-profile">
                <div class="row g-4">
                    <!-- Personal Info -->
                    <div class="col-lg-8">
                        <div class="glass-panel p-4">
                            <h4 class="fw-bold mb-4 text-white">Personal Details</h4>
                            <form method="POST" enctype="multipart/form-data">
                                <input type="hidden" name="update_profile" value="1">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="text-sm-label">Full Name</label>
                                        <input type="text" class="form-control" name="name"
                                            value="{{ data.profile.name }}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="text-sm-label">Job Title</label>
                                        <input type="text" class="form-control" name="title"
                                            value="{{ data.profile.title }}">
                                    </div>
                                    <div class="col-12">
                                        <label class="text-sm-label">Hero Intro</label>
                                        <textarea class="form-control" name="intro"
                                            rows="2">{{ data.profile.intro }}</textarea>
                                    </div>
                                    <div class="col-12">
                                        <label class="text-sm-label">About Bio</label>
                                        <textarea class="form-control" name="bio"
                                            rows="5">{{ data.profile.bio }}</textarea>
                                    </div>
                                    <div class="col-12 text-end">
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Sidebar Assets -->
                    <div class="col-lg-4">
                        <div class="glass-panel p-4 mb-4">
                            <h5 class="fw-bold mb-3 text-white">Profile Picture</h5>
                            <div class="text-center mb-3">
                                <img id="profilePreview"
                                    src="{{ data.profile.image or 'https://via.placeholder.com/150' }}"
                                    class="rounded-circle shadow-lg mb-3"
                                    style="width: 120px; height: 120px; object-fit: cover; border: 3px solid rgba(255,255,255,0.1);">
                            </div>
                            <form method="POST" enctype="multipart/form-data">
                                <input type="hidden" name="update_profile" value="1">
                                <input type="file" class="form-control mb-2" name="image_file" id="imageFileInput">
                                <input type="text" class="form-control mb-2" name="image"
                                    value="{{ data.profile.image }}" placeholder="Image URL">
                                <label class="text-sm-label mt-3">Resume (PDF)</label>
                                <input type="file" class="form-control mb-2" name="resume_file">
                                <input type="text" class="form-control" name="resume_link"
                                    value="{{ data.profile.resume_link }}" placeholder="Resume URL">
                                <button type="submit" class="btn btn-primary w-100 mt-3">Update Assets</button>
                            </form>
                        </div>
                    </div>

                    <!-- Education -->
                    <div class="col-12">
                        <div class="glass-panel p-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="fw-bold m-0 text-white">Education History</h4>
                            </div>

                            <!-- Add New -->
                            <form method="POST"
                                class="mb-4 p-3 border border-dashed border-secondary rounded bg-dark bg-opacity-25">
                                <input type="hidden" name="add_education" value="1">
                                <div class="row g-2">
                                    <div class="col-md-4"><input type="text" class="form-control" name="new_edu_degree"
                                            placeholder="Degree (e.g. BS CS)" required></div>
                                    <div class="col-md-4"><input type="text" class="form-control"
                                            name="new_edu_institution" placeholder="Institution" required></div>
                                    <div class="col-md-2"><input type="text" class="form-control" name="new_edu_year"
                                            placeholder="Year" required></div>
                                    <div class="col-md-2"><button type="submit" class="btn btn-success w-100"><i
                                                class="fas fa-plus"></i> Add</button></div>
                                </div>
                            </form>

                            <!-- List -->
                            <form method="POST" id="updateEducationForm">
                                <input type="hidden" name="update_education" value="1">
                                <div class="table-responsive">
                                    <table class="table table-borderless align-middle">
                                        <thead class="text-muted border-bottom border-secondary">
                                            <tr>
                                                <th>Degree</th>
                                                <th>Institution</th>
                                                <th>Year</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for edu in data.education %}
                                            <tr class="border-bottom border-secondary border-opacity-25">
                                                <td><input type="text"
                                                        class="form-control form-control-sm border-0 bg-transparent text-white"
                                                        name="edu_degree" value="{{ edu.degree }}"></td>
                                                <td><input type="text"
                                                        class="form-control form-control-sm border-0 bg-transparent text-white"
                                                        name="edu_institution" value="{{ edu.institution }}"></td>
                                                <td><input type="text"
                                                        class="form-control form-control-sm border-0 bg-transparent text-white"
                                                        name="edu_year" value="{{ edu.year }}"></td>
                                                <td><button type="button" class="btn btn-sm btn-outline-danger"
                                                        onclick="confirmDelete('{{ loop.index0 }}', 'education')"><i
                                                            class="fas fa-trash"></i></button></td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="text-end mt-3">
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SKILLS TAB -->
            <div class="tab-pane fade" id="v-pills-skills">
                <div class="glass-panel p-4">
                    <h4 class="fw-bold mb-3 text-white">Technical Skills</h4>
                    <p class="text-secondary mb-4">Enter one skill per line. You can optionally add a percentage like
                        <code>Python: 90</code>.
                    </p>
                    <form method="POST">
                        <input type="hidden" name="update_skills" value="1">
                        <textarea class="form-control font-monospace" name="skills" rows="15"
                            style="background: rgba(0,0,0,0.3); color: #a5b4fc;">{{ data.skills | join('\n') }}</textarea>
                        <div class="mt-3 text-end">
                            <button type="submit" class="btn btn-primary">Update Skills</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- PROJECTS TAB -->
            <div class="tab-pane fade" id="v-pills-projects">
                <!-- Add New Toggle -->
                <div class="glass-panel p-4 mb-4">
                    <h5 class="fw-bold mb-3 text-white">Add New Project</h5>
                    <form method="POST" enctype="multipart/form-data">
                        <input type="hidden" name="add_project" value="1">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" name="new_project_title"
                                    placeholder="Project Title" required>
                            </div>
                            <div class="col-md-6">
                                <input type="text" class="form-control" name="new_project_tech"
                                    placeholder="Tech Stack (comma separated)">
                            </div>
                            <div class="col-12">
                                <textarea class="form-control" name="new_project_desc" placeholder="Description"
                                    rows="2"></textarea>
                            </div>
                            <div class="col-md-5">
                                <input type="text" class="form-control" name="new_project_github"
                                    placeholder="GitHub Link">
                            </div>
                            <div class="col-md-5">
                                <input type="file" class="form-control" name="new_project_image_file">
                            </div>
                            <div class="col-md-2">
                                <div class="form-check pt-2">
                                    <input class="form-check-input bg-dark border-secondary" type="checkbox"
                                        name="new_project_featured" id="featNew">
                                    <label class="form-check-label text-muted" for="featNew">Featured?</label>
                                </div>
                            </div>
                            <div class="col-12 text-end">
                                <button type="submit" class="btn btn-success px-4">Create Project</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Existing Projects Grid -->
                <form method="POST" enctype="multipart/form-data" id="updateProjectsForm">
                    <input type="hidden" name="update_projects" value="1">
                    <div class="row g-4">
                        {% for project in data.projects %}
                        <div class="col-lg-6 col-xl-4">
                            <div class="glass-panel h-100 overflow-hidden position-relative group">
                                <!-- Image Preview -->
                                <div style="height: 160px; overflow: hidden; position: relative;">
                                    <img src="{{ project.image }}" class="w-100 h-100"
                                        style="object-fit: cover; transition: 0.5s;" alt="Project">
                                    <div class="position-absolute bottom-0 end-0 p-2">
                                        <span class="badge bg-dark bg-opacity-75">
                                            {% if project.featured %}<i class="fas fa-star text-warning"></i> Featured{%
                                            else %}Standard{% endif %}
                                        </span>
                                    </div>
                                </div>

                                <div class="p-3">
                                    <!-- Inputs -->
                                    <div class="mb-2">
                                        <label class="text-sm-label">Title</label>
                                        <input type="text" class="form-control" name="project_title_{{ loop.index0 }}"
                                            value="{{ project.title }}">
                                    </div>
                                    <div class="mb-2">
                                        <label class="text-sm-label">Description</label>
                                        <textarea class="form-control form-control-sm"
                                            name="project_desc_{{ loop.index0 }}"
                                            rows="2">{{ project.description }}</textarea>
                                    </div>
                                    <div class="mb-2">
                                        <label class="text-sm-label">Tech Stack</label>
                                        <input type="text" class="form-control form-control-sm"
                                            name="project_tech_{{ loop.index0 }}" value="{{ project.technologies }}">
                                    </div>
                                    <div class="mb-3">
                                        <label class="text-sm-label">GitHub</label>
                                        <div class="input-group input-group-sm">
                                            <span
                                                class="input-group-text bg-transparent border-end-0 border-secondary text-muted"><i
                                                    class="fab fa-github"></i></span>
                                            <input type="text" class="form-control border-start-0 ps-0"
                                                name="project_github_{{ loop.index0 }}"
                                                value="{{ project.github_link }}">
                                        </div>
                                    </div>

                                    <div
                                        class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top border-secondary border-opacity-25">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input bg-dark border-secondary" type="checkbox"
                                                name="project_featured_{{ loop.index0 }}" {% if project.featured
                                                %}checked{% endif %}>
                                            <label class="form-check-label small text-muted">Featured</label>
                                        </div>
                                        <button type="button" class="btn btn-sm btn-outline-danger rounded-circle"
                                            style="width: 32px; height: 32px; padding: 0;"
                                            onclick="confirmDelete('{{ loop.index0 }}', 'project')">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </div>

                                <input type="hidden" name="project_image_{{ loop.index0 }}" value="{{ project.image }}">
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="position-fixed bottom-0 end-0 p-4" style="z-index: 999;">
                        <button type="submit" class="btn btn-primary shadow-lg btn-lg rounded-pill"><i
                                class="fas fa-save me-2"></i> Save Projects</button>
                    </div>
                </form>
            </div>

            <!-- CERTIFICATIONS TAB -->
            <div class="tab-pane fade" id="v-pills-certs">
                <div class="glass-panel p-4">
                    <h4 class="fw-bold mb-4 text-white">Certifications</h4>

                    <!-- Add Cert -->
                    <form method="POST" id="addCertForm" class="mb-4">
                        <input type="hidden" name="add_cert" value="1">
                        <div class="row g-2 align-items-end">
                            <div class="col-md-3"><label class="text-sm-label">Title</label><input type="text"
                                    class="form-control" name="new_cert_title" required></div>
                            <div class="col-md-3"><label class="text-sm-label">Org</label><input type="text"
                                    class="form-control" name="new_cert_org" required></div>
                            <div class="col-md-2"><label class="text-sm-label">Date</label><input type="text"
                                    class="form-control" name="new_cert_date"></div>
                            <div class="col-md-3"><label class="text-sm-label">Link</label><input type="text"
                                    class="form-control" name="new_cert_link"></div>
                            <div class="col-md-1"><button type="submit" class="btn btn-success w-100"><i
                                        class="fas fa-plus"></i></button></div>
                        </div>
                        <div class="mt-2">
                            <input type="text" class="form-control" name="new_cert_desc"
                                placeholder="Brief description...">
                        </div>
                    </form>

                    <!-- Edit Certs -->
                    <form method="POST" id="updateCertsForm">
                        <input type="hidden" name="update_certs" value="1">
                        <div class="list-group list-group-flush">
                            {% for cert in data.certifications %}
                            <div
                                class="list-group-item bg-transparent px-0 py-3 border-bottom border-secondary border-opacity-25">
                                <div class="row g-2">
                                    <div class="col-md-4">
                                        <input type="text" class="form-control fw-bold"
                                            name="cert_title_{{ loop.index0 }}" value="{{ cert.title }}">
                                        <input type="text" class="form-control form-control-sm mt-1 text-secondary"
                                            name="cert_desc_{{ loop.index0 }}" value="{{ cert.description }}">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control" name="cert_org_{{ loop.index0 }}"
                                            value="{{ cert.organization }}">
                                    </div>
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" name="cert_date_{{ loop.index0 }}"
                                            value="{{ cert.date }}">
                                    </div>
                                    <div class="col-md-3 d-flex gap-2">
                                        <input type="text" class="form-control" name="cert_link_{{ loop.index0 }}"
                                            value="{{ cert.link }}">
                                        <button type="button" class="btn btn-outline-danger"
                                            onclick="confirmDelete('{{ loop.index0 }}', 'cert')"><i
                                                class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-3 text-end">
                            <button type="submit" class="btn btn-primary">Save Certifications</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- CONTACT TAB -->
            <div class="tab-pane fade" id="v-pills-contact">
                <div class="glass-panel p-4" style="max-width: 800px; margin: 0 auto;">
                    <h4 class="fw-bold mb-4 text-white">Contact Information</h4>
                    <form method="POST">
                        <input type="hidden" name="update_contact" value="1">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="text-sm-label"><i class="fas fa-envelope me-1"></i> Email</label>
                                <input type="email" class="form-control" name="email" value="{{ data.contact.email }}">
                            </div>
                            <div class="col-md-6">
                                <label class="text-sm-label"><i class="fas fa-map-marker-alt me-1"></i> Location</label>
                                <input type="text" class="form-control" name="location"
                                    value="{{ data.contact.location }}">
                            </div>
                            <div class="col-12">
                                <hr class="my-2 border-secondary opacity-25">
                            </div>
                            <div class="col-md-6">
                                <label class="text-sm-label"><i class="fab fa-linkedin me-1"></i> LinkedIn</label>
                                <input type="text" class="form-control" name="linkedin"
                                    value="{{ data.contact.linkedin }}">
                            </div>
                            <div class="col-md-6">
                                <label class="text-sm-label"><i class="fab fa-github me-1"></i> GitHub</label>
                                <input type="text" class="form-control" name="github" value="{{ data.contact.github }}">
                            </div>
                            <div class="col-md-6">
                                <label class="text-sm-label"><i class="fab fa-twitter me-1"></i> Twitter (X)</label>
                                <input type="text" class="form-control" name="twitter"
                                    value="{{ data.contact.twitter }}">
                            </div>
                            <div class="col-md-6">
                                <label class="text-sm-label"><i class="fab fa-instagram me-1"></i> Instagram</label>
                                <input type="text" class="form-control" name="instagram"
                                    value="{{ data.contact.instagram }}">
                            </div>
                            <div class="col-12 text-end mt-4">
                                <button type="submit" class="btn btn-primary px-5">Update Contact</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </main>
</div>

<!-- DATA & LOGIC -->
<script id="analytics-data" type="application/json">{{ analytics | tojson | safe }}</script>
<script>
    // --- Sidebar Mobile Toggle ---
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarClose = document.getElementById('sidebarClose');

    sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('active');
    });

    if (sidebarClose) {
        sidebarClose.addEventListener('click', () => {
            sidebar.classList.remove('active');
        });
    }

    // --- Image Preview ---
    const fileInput = document.getElementById('imageFileInput');
    const preview = document.getElementById('profilePreview');
    if (fileInput) {
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => preview.src = e.target.result;
                reader.readAsDataURL(file);
            }
        });
    }

    // --- Deletion Helper ---
    window.confirmDelete = function (index, type) {
        if (!confirm(`Delete this ${type}?`)) return;

        const formId = type === 'project' ? 'updateProjectsForm' :
            type === 'education' ? 'updateEducationForm' : 'updateCertsForm';

        const form = document.getElementById(formId);
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = `delete_${type}_${index}`;
        input.value = '1';
        form.appendChild(input);
        form.submit();
    }

    // --- Chart.js Configuration ---
    const analytics = JSON.parse(document.getElementById('analytics-data').textContent);

    // Global defaults for Dark Mode
    Chart.defaults.font.family = "'Inter', sans-serif";
    Chart.defaults.color = "#94a3b8"; // Slate 400
    Chart.defaults.scale.grid.color = "rgba(255, 255, 255, 0.05)";

    // Gradient helper
    function getGradient(ctx, colorStart, colorEnd) {
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, colorStart);
        gradient.addColorStop(1, colorEnd);
        return gradient;
    }

    // 1. Daily Visits (Area Chart)
    const ctx1 = document.getElementById('dailyVisitsChart').getContext('2d');
    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: Object.keys(analytics.daily_visits || {}),
            datasets: [{
                label: 'Visits',
                data: Object.values(analytics.daily_visits || {}),
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: '#1e293b', // Match chart bg
                pointBorderColor: '#6366f1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, grid: { borderDash: [5, 5] } } }
        }
    });

    // 2. Page Views (Bar)
    new Chart(document.getElementById('pageViewsChart'), {
        type: 'bar',
        data: {
            labels: Object.keys(analytics.page_views || {}).map(p => p === '/' ? 'Home' : p.replace('/', '')),
            datasets: [{
                label: 'Views',
                data: Object.values(analytics.page_views || {}),
                backgroundColor: '#ec4899',
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
        }
    });

    // 3. Section Views (Doughnut)
    new Chart(document.getElementById('sectionViewsChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(analytics.section_views || {}),
            datasets: [{
                data: Object.values(analytics.section_views || {}),
                backgroundColor: ['#6366f1', '#ec4899', '#10b981', '#f59e0b', '#3b82f6'],
                borderColor: '#1e293b', // Match panel bg
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'right', labels: { boxWidth: 10 } } }
        }
    });

    // 4. Interactions (Line)
    new Chart(document.getElementById('interactionsChart'), {
        type: 'line',
        data: {
            labels: Object.keys(analytics.interactions || {}),
            datasets: [{
                label: 'Clicks',
                data: Object.values(analytics.interactions || {}),
                borderColor: '#10b981',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
        }
    });
</script>
{% endblock %}